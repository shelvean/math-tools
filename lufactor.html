
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="description" content="A web-based tool to compute the PA = LU factorization of a square matrix with options for partial pivoting, scaled partial pivoting, and no pivoting. Results are displayed as fractions for short decimals (≤4 non-zero digits) or repeating decimals (e.g., 1.3333..., 0.66666...) if numerator and denominator are less than 500, otherwise as decimals." />
    <meta name="keywords" content="LU decomposition, PA = LU factorization, matrix factorization, linear algebra, matrix calculator, numerical analysis, partial pivoting, scaled partial pivoting, no pivoting" />
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LEQE004C92"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-LEQE004C92');
</script>
    <title>PA = LU Factorization with Pivoting Options</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mathjs@14.6.0/lib/browser/math.js"></script>
    <style>
        .katex-display { margin: 1em 0; overflow-x: auto; }
        body { padding-left: 12.5vw; padding-right: 12.5vw; }
        @media (max-width: 900px) { body { padding-left: 3vw; padding-right: 3vw; }}
        .matrix-cell { width: 4rem; padding: 0.5rem; text-align: center; border: 2px solid #d1d5db; border-radius: 0.375rem; }
        .matrix-cell:hover { border-color: #3b82f6; border-width: 3px; }
        .matrix-cell:focus { outline: none; border-color: #3b82f6; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
    <nav class="fixed top-0 left-0 w-full z-10 bg-white shadow-md">
        <div class="max-w-4xl mx-auto px-4 py-2">
            <ul class="flex justify-center space-x-4">
                <li><a href="index.html" class="text-indigo-500 hover:text-blue-600 font-bold text-xl">Home</a></li>
                <li><a href="teaching.html" class="text-indigo-500 hover:text-blue-600 font-bold text-xl">Teaching</a></li>
                <li><a href="projects.html" class="text-indigo-500 hover:text-blue-600 font-bold text-xl">Diff Eq</a></li>
                <li><a href="linear.html" class="text-indigo-500 hover:text-blue-600 font-bold text-xl">Linear Algebra</a></li>
				<li><a href="numerical.html" class="text-indigo-500 hover:text-blue-600 font-bold text-xl">Numerical Methods</a></li>

            </ul>
        </div>
    </nav>
    <div class="bg-white p-6 rounded-lg shadow-md max-w-4xl w-full mt-16">
        <h2 class="text-2xl font-bold mb-4 text-center text-gray-800">PA = LU Factorization</h2>
        <p class="text-center text-gray-600 mb-6">
            Compute the <strong>PA = LU Factorization</strong> of a square matrix with various pivoting strategies.<br>
            <span class="text-sm">Essential for solving linear systems, computing determinants, and matrix inversion.</span>
        </p>

        <!-- About LU Factorization - Collapsible -->
        <div class="bg-blue-50 border border-blue-300 rounded-lg mb-6 overflow-hidden">
            <button onclick="toggleLUConcepts()" class="w-full p-4 text-left flex items-center justify-between hover:bg-blue-100 transition duration-200">
                <h3 class="font-bold text-lg text-blue-800">About LU Factorization</h3>
                <span id="luToggleIcon" class="text-blue-800 font-bold text-xl">−</span>
            </button>
            <div id="luContent" class="px-4 pb-4">
                <p class="text-gray-700 mb-2 text-sm">For a square matrix $A$, the LU factorization with pivoting is:</p>
                <p class="text-center mb-3">$$ PA = LU $$</p>

                <p class="text-gray-700 mb-2"><strong>Components:</strong></p>
                <ul class="text-gray-700 text-sm mb-3 ml-6 list-disc">
                    <li>$P$ is a permutation matrix (row exchanges)</li>
                    <li>$L$ is a unit lower triangular matrix (diagonal entries are 1)</li>
                    <li>$U$ is an upper triangular matrix</li>
                </ul>

                <p class="text-gray-700 mb-2"><strong>Pivoting Strategies:</strong></p>
                <ul class="text-gray-700 text-sm mb-3 ml-6 list-disc">
                    <li><strong>Partial Pivoting:</strong> Choose largest magnitude element in current column</li>
                    <li><strong>Scaled Partial Pivoting:</strong> Account for row scaling to reduce errors</li>
                    <li><strong>No Pivoting:</strong> No row exchanges (may fail for some matrices)</li>
                </ul>

                <p class="text-gray-700 text-sm">Used to solve $Ax = b$ by solving $Ly = Pb$ then $Ux = y$ (both triangular systems).</p>
            </div>
        </div>

        <div class="bg-gray-50 p-4 rounded-lg mb-6">
            <div class="flex justify-center items-center space-x-4">
                <span class="text-gray-700">Matrix size $n$:</span>
                <input type="number" id="n" min="1" required class="w-16 p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button type="button" onclick="generateMatrix()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition duration-300">Generate Matrix</button>
                <button type="button" onclick="loadExample()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 transition duration-300">Load Example</button>
            </div>
            <div class="mt-4 flex justify-center items-center space-x-4">
                <span class="text-gray-700">Pivoting method:</span>
                <label class="inline-flex items-center">
                    <input type="radio" name="pivoting" value="partial" checked class="form-radio">
                    <span class="ml-2">Partial Pivoting</span>
                </label>
                <label class="inline-flex items-center">
                    <input type="radio" name="pivoting" value="scaled" class="form-radio">
                    <span class="ml-2">Scaled Partial Pivoting</span>
                </label>
                <label class="inline-flex items-center">
                    <input type="radio" name="pivoting" value="none" class="form-radio">
                    <span class="ml-2">No Pivoting</span>
                </label>
            </div>
        </div>
        <div id="matrixInput" class="mb-6 overflow-x-auto"></div>
        <div class="flex justify-center space-x-4 mb-6">
            <button id="calcBtn" type="button" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600 transition duration-300 w-1/3">Compute LU</button>
            <button id="clearBtn" type="button" class="bg-gray-500 text-white px-6 py-2 rounded hover:bg-gray-600 transition duration-300 w-1/3">Clear All</button>
        </div>
        <div id="result" class="mt-6 p-4 bg-gray-50 rounded-lg"></div>
        <div class="mt-6 border-t pt-4 text-center text-gray-500 text-sm">
            © 2025 Shelvean Kapita: kapita@tamu.edu <br> Last modified: June 2, 2025
            <br>
            Licensed under the <a href="https://opensource.org/licenses/MIT" target="_blank">MIT License</a>.
        </div>
    </div>
    <script>
        // Initialize KaTeX rendering after scripts are loaded
        document.addEventListener("DOMContentLoaded", function() {
            renderMathInElement(document.body, {
                delimiters: [
                    { left: "$$", right: "$$", display: true },
                    { left: "$", right: "$", display: false }
                ],
                throwOnError: false,
                errorCallback: function(err) { console.error("KaTeX rendering error:", err); }
            });
        });

        function generateMatrix() {
            var n = parseInt(document.getElementById("n").value, 10);
            if (isNaN(n) || n <= 0) {
                alert("Please enter a valid positive integer for n.");
                return;
            }
            var matrixDiv = document.getElementById("matrixInput");
            matrixDiv.innerHTML = "";
            var statementDiv = document.createElement("div");
            statementDiv.className = "text-center mb-4";
            var statement = document.createElement("div");
            statement.className = "latex";
            statement.textContent = `$$ \\text{Compute the PA = LU factorization} $$`;
            statementDiv.appendChild(statement);
            var emptyStatement = document.createElement("div");
            emptyStatement.className = "latex";
            emptyStatement.textContent = `$$ \\text{(empty spaces are treated as 0)} $$`;
            statementDiv.appendChild(emptyStatement);
            matrixDiv.appendChild(statementDiv);
            var aDiv = document.createElement("div");
            aDiv.className = "flex flex-col items-center";
            var aLabel = document.createElement("p");
            aLabel.className = "text-center font-semibold latex";
            aLabel.textContent = "Matrix $A$";
            aDiv.appendChild(aLabel);
            var aTable = document.createElement("table");
            aTable.className = "border-collapse";
            for (var i = 0; i < n; i++) {
                var tr = document.createElement("tr");
                for (var j = 0; j < n; j++) {
                    var td = document.createElement("td");
                    td.className = "p-1";
                    var input = document.createElement("input");
                    input.type = "text";
                    input.className = "matrix-cell";
                    input.id = "A_" + i + "_" + j;
                    td.appendChild(input);
                    tr.appendChild(td);
                }
                aTable.appendChild(tr);
            }
            aDiv.appendChild(aTable);
            matrixDiv.appendChild(aDiv);
            renderMathInElement(matrixDiv, {
                delimiters: [
                    { left: "$$", right: "$$", display: true },
                    { left: "$", right: "$", display: false }
                ],
                throwOnError: false
            });
        }

        function clearAll() {
            document.getElementById("n").value = "";
            document.getElementById("matrixInput").innerHTML = "";
            document.getElementById("result").innerHTML = "";
        }

        function parseFraction(str) {
            str = str.trim();
            if (str === '') return 0;
            try {
                let evaluated = math.evaluate(str);
                if (typeof evaluated === 'number') {
                    return evaluated;
                } else {
                    return 0;
                }
            } catch (e) {
                return 0;
            }
        }

        function readMatrix() {
            var n = parseInt(document.getElementById("n").value, 10);
            var A = [];
            for (var i = 0; i < n; i++) {
                var row = [];
                for (var j = 0; j < n; j++) {
                    var cell = document.getElementById("A_" + i + "_" + j);
                    var value = cell.value.trim();
                    var num = parseFraction(value);
                    if (isNaN(num)) {
                        alert("Please enter valid numbers, fractions, or mathematical expressions in all cells.");
                        return null;
                    }
                    row.push(num);
                }
                A.push(row);
            }
            return A;
        }

        function swapRows(matrix, row1, row2) {
            const temp = matrix[row1];
            matrix[row1] = matrix[row2];
            matrix[row2] = temp;
        }

        function identityMatrix(size) {
            const I = Array(size).fill().map(() => Array(size).fill(0));
            for (let i = 0; i < size; i++) {
                I[i][i] = 1;
            }
            return I;
        }

        function luDecompositionPartial(A) {
            const n = A.length;
            let P = identityMatrix(n);
            let L = Array(n).fill().map(() => Array(n).fill(0));
            let U = A.map(row => [...row]);
            for (let k = 0; k < n; k++) {
                let maxIndex = k;
                let maxValue = Math.abs(U[k][k]);
                for (let i = k + 1; i < n; i++) {
                    if (Math.abs(U[i][k]) > maxValue) {
                        maxValue = Math.abs(U[i][k]);
                        maxIndex = i;
                    }
                }
                if (maxValue === 0) {
                    continue;
                }
                swapRows(U, k, maxIndex);
                swapRows(P, k, maxIndex);
                for (let col = 0; col < k; col++) {
                    const temp = L[k][col];
                    L[k][col] = L[maxIndex][col];
                    L[maxIndex][col] = temp;
                }
                for (let j = k + 1; j < n; j++) {
                    L[j][k] = U[j][k] / U[k][k];
                    for (let m = k; m < n; m++) {
                        U[j][m] -= L[j][k] * U[k][m];
                    }
                }
            }
            for (let i = 0; i < n; i++) {
                L[i][i] = 1;
            }
            return { P, L, U, message: "" };
        }

        function luDecompositionScaled(A) {
            const n = A.length;
            const s = A.map(row => Math.max(...row.map(Math.abs)));
            let P = identityMatrix(n);
            let L = Array(n).fill().map(() => Array(n).fill(0));
            let U = A.map(row => [...row]);
            for (let k = 0; k < n; k++) {
                let maxRatio = -1;
                let maxIndex = k;
                for (let i = k; i < n; i++) {
                    if (s[i] > 0) {
                        const ratio = Math.abs(U[i][k]) / s[i];
                        if (ratio > maxRatio) {
                            maxRatio = ratio;
                            maxIndex = i;
                        }
                    }
                }
                if (maxRatio > 0) {
                    swapRows(U, k, maxIndex);
                    swapRows(P, k, maxIndex);
                    for (let col = 0; col < k; col++) {
                        const temp = L[k][col];
                        L[k][col] = L[maxIndex][col];
                        L[maxIndex][col] = temp;
                    }
                }
                for (let j = k + 1; j < n; j++) {
                    L[j][k] = U[j][k] / U[k][k];
                    for (let m = k; m < n; m++) {
                        U[j][m] -= L[j][k] * U[k][m];
                    }
                }
            }
            for (let i = 0; i < n; i++) {
                L[i][i] = 1;
            }
            return { P, L, U, message: "" };
        }

        function luDecompositionNoPivoting(A) {
            const n = A.length;
            let P = identityMatrix(n);
            let L = Array(n).fill().map(() => Array(n).fill(0));
            let U = A.map(row => [...row]);
            let message = "";
            for (let k = 0; k < n; k++) {
                if (Math.abs(U[k][k]) < 1e-10) {
                    let hasNonZeroBelow = false;
                    for (let j = k + 1; j < n; j++) {
                        if (Math.abs(U[j][k]) > 1e-10) {
                            hasNonZeroBelow = true;
                            break;
                        }
                    }
                    if (hasNonZeroBelow) {
                        message = "Zero pivot encountered at step " + (k + 1) + " with non-zero entries below. LU decomposition cannot be completed without pivoting.";
                        break;
                    }
                } else {
                    for (let j = k + 1; j < n; j++) {
                        L[j][k] = U[j][k] / U[k][k];
                        for (let m = k; m < n; m++) {
                            U[j][m] -= L[j][k] * U[k][m];
                        }
                    }
                }
            }
            if (message === "") {
                for (let i = 0; i < n; i++) {
                    L[i][i] = 1;
                }
            }
            return { P, L, U, message };
        }

        function gcd(a, b) {
            a = Math.abs(a);
            b = Math.abs(b);
            while (b !== 0) {
                let temp = b;
                b = a % b;
                a = temp;
            }
            return a;
        }

        function lcm(a, b) {
            return Math.abs(a * b) / gcd(a, b);
        }

        function isShortDecimal(num) {
            if (Math.abs(num) < 1e-12) return false;
            let str = num.toFixed(10).replace(/\.?0+$/, '');
            let decimalPart = str.split('.')[1];
            if (!decimalPart) return false;
            let nonZeroCount = (decimalPart.match(/[1-9]/g) || []).length;
            return nonZeroCount <= 4;
        }

        function floatToFraction(num, tolerance = 1e-6, maxIter = 30) {
            if (Math.abs(num) < 1e-12) return { numer: 0, denom: 1 };
            let sign = Math.sign(num);
            num = Math.abs(num);
            let a = Math.floor(num);
            let h = a;
            let k = 1;
            let hPrev = 1;
            let kPrev = 0;
            let x = num - a;
            let iter = 0;
            while (x > tolerance && iter < maxIter) {
                x = 1 / x;
                a = Math.floor(x);
                let hTemp = a * h + hPrev;
                let kTemp = a * k + kPrev;
                hPrev = h;
                kPrev = k;
                h = hTemp;
                k = kTemp;
                x -= a;
                iter++;
                if (Math.abs(num - h / k) < tolerance) break;
            }
            return { numer: sign * h, denom: k };
        }

        function formatForLatex(val) {
            if (typeof val === 'number') {
                if (Math.abs(val) < 1e-12) return "0";
                if (Math.abs(val - Math.round(val)) < 1e-12) return Math.round(val).toString();
                let fraction = floatToFraction(val);
                let isFraction = Math.abs(val - fraction.numer / fraction.denom) < 1e-6;
                if ((isShortDecimal(val) || isFraction) && Math.abs(fraction.numer) < 500 && fraction.denom < 500) {
                    if (fraction.denom === 1) return fraction.numer.toString();
                    return fraction.numer + '/' + fraction.denom;
                } else {
                    return val.toFixed(4).replace(/\.?0+$/, '');
                }
            } else if (val.re !== undefined && val.im !== undefined) {
                let re_part = formatForLatex(val.re);
                let im_abs = Math.abs(val.im);
                let im_part = formatForLatex(im_abs);
                if (im_part === "0") return re_part;
                let im_sign = val.im < 0 ? '-' : '+';
                if (im_part === '1') im_part = '';
                let im_str = im_part ? im_part + 'i' : 'i';
                if (re_part === '0') {
                    return (val.im < 0 ? '-' : '') + im_str;
                }
                return re_part + im_sign + im_str;
            }
            return val.toString();
        }

        function matrixToLatex(M) {
            if (!M || M.length === 0) return '';
            const rows = M.length;
            const cols = M[0].length;
            let latex = "\\begin{bmatrix}";
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    latex += formatForLatex(M[i][j]);
                    if (j < cols - 1) latex += " & ";
                }
                if (i < rows - 1) latex += " \\\\ ";
            }
            latex += "\\end{bmatrix}";
            return latex;
        }

        document.getElementById("clearBtn").addEventListener("click", clearAll);

        document.getElementById("calcBtn").addEventListener("click", function () {
            var A = readMatrix();
            if (A === null) return;
            var pivotingMethod = document.querySelector('input[name="pivoting"]:checked').value;
            var decomposition;
            if (pivotingMethod === "partial") {
                decomposition = luDecompositionPartial(A);
            } else if (pivotingMethod === "scaled") {
                decomposition = luDecompositionScaled(A);
            } else if (pivotingMethod === "none") {
                decomposition = luDecompositionNoPivoting(A);
            }
            var { P, L, U, message } = decomposition;
            var P_latex = matrixToLatex(P);
            var A_latex = matrixToLatex(A);
            var resultDiv = document.getElementById("result");
            if (message) {
                resultDiv.innerHTML = `
                    <div class="latex">$$ PA = LU $$</div>
                    <div class="flex justify-center space-x-4">
                        <div class="latex">$$ P = ${P_latex} $$</div>
                        <div class="latex">$$ A = ${A_latex} $$</div>
                    </div>
                    <div class="text-center text-red-500 mt-4">${message}</div>
                `;
            } else {
                var L_latex = matrixToLatex(L);
                var U_latex = matrixToLatex(U);
                resultDiv.innerHTML = `
                    <div class="latex">$$ PA = LU $$</div>
                    <div class="flex justify-center space-x-4">
                        <div class="latex">$$ P = ${P_latex} $$</div>
                        <div class="latex">$$ A = ${A_latex} $$</div>
                        <div class="latex">$$ L = ${L_latex} $$</div>
                        <div class="latex">$$ U = ${U_latex} $$</div>
                    </div>
                `;
            }
            renderMathInElement(resultDiv, {
                delimiters: [{ left: "$$", right: "$$", display: true }],
                throwOnError: false
            });
        });

        function toggleLUConcepts() {
            var content = document.getElementById("luContent");
            var icon = document.getElementById("luToggleIcon");
            if (content.style.display === "none") {
                content.style.display = "block";
                icon.textContent = "−";
            } else {
                content.style.display = "none";
                icon.textContent = "+";
            }
        }

        function loadExample() {
            document.getElementById("n").value = "3";
            generateMatrix();
            setTimeout(() => {
                // Example: 3x3 matrix for LU factorization
                document.getElementById("A_0_0").value = "2";
                document.getElementById("A_0_1").value = "1";
                document.getElementById("A_0_2").value = "1";
                document.getElementById("A_1_0").value = "4";
                document.getElementById("A_1_1").value = "3";
                document.getElementById("A_1_2").value = "3";
                document.getElementById("A_2_0").value = "8";
                document.getElementById("A_2_1").value = "7";
                document.getElementById("A_2_2").value = "9";
            }, 100);
        }

        // Render LaTeX on page load
        document.addEventListener("DOMContentLoaded", function() {
            renderMathInElement(document.body, {
                delimiters: [
                    { left: "$$", right: "$$", display: true },
                    { left: "$", right: "$", display: false }
                ],
                throwOnError: false
            });
        });
    </script>
</body>

</html>
