<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="An interactive visualizer for Newton's Method with custom function input, demonstrating root-finding convergence with automatic plot adjustment.">
  <meta name="keywords" content="Newton's Method, root-finding, numerical analysis, interactive visualizer, mathematics, custom functions">
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LEQE004C92"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-LEQE004C92');
</script>
  <title>Newton's Method Visualizer</title>
  <!-- KaTeX CDN links -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"></script>
  <!-- Math.js for parsing and symbolic differentiation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
  <!-- d3.js and function-plot.js -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://unpkg.com/function-plot@1.22.4/dist/function-plot.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f8f9fa; margin: 0; padding: 0; }
    .container { max-width: 1400px; margin: 0 auto; padding: 1rem; }
    .katex-display { overflow-x: auto; padding: 0.25rem; }
    .current-function { font-size: 1.1rem; padding: 0.75rem; text-align: center; background-color: #f8f9fa; border-radius: 0.375rem; border: 1px solid #dee2e6; font-family: 'Courier New', monospace; }
    .control-panel { background-color: #ffffff; padding: 1.25rem; border-radius: 0.5rem; border: 1px solid #dee2e6; width: 100%; font-size: 0.875rem; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
    #graph { border: 1px solid #dee2e6; border-radius: 0.5rem; width: 100%; height: 500px; background-color: #ffffff; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
    .btn-primary { background-color: #6c757d; color: white; }
    .btn-primary:hover { background-color: #5a6268; }
    .btn-secondary { background-color: #e9ecef; color: #1f2937 !important; border: 1px solid #9ca3af; font-weight: 600; }
    .btn-secondary:hover { background-color: #dae0e5; color: #1f2937 !important; }
    .btn-success { background-color: #28a745; color: white; }
    .btn-success:hover { background-color: #218838; }
    .btn-danger { background-color: #dc3545; color: white; }
    .btn-danger:hover { background-color: #c82333; }
    .converged-message { background-color: #d4edda; color: #155724; padding: 0.75rem 1rem; border-radius: 0.375rem; text-align: center; font-size: 0.875rem; display: none; border: 1px solid #c3e6cb; }
    .converged-message.show { display: block; }
    .compact-table { font-size: 0.85rem; }
    .compact-table th, .compact-table td { padding: 0.5rem 0.75rem; }
    .nav-bar { padding: 0.75rem 0; font-size: 1rem; background-color: #ffffff; border-bottom: 2px solid #e5e7eb; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    .mono-font { font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace; }
    .control-panel label { font-weight: 600; color: #4b5563; }
    .method-card { background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border: 1px solid #e2e8f0; border-radius: 0.5rem; padding: 1rem; }
    .nav-link { color: #1e40af; font-weight: 500; padding: 0.5rem 1rem; border-radius: 0.375rem; transition: all 0.2s; }
    .nav-link:hover { background-color: #f0f9ff; color: #1d4ed8; }
    .header-section { background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); border-bottom: 1px solid #cbd5e1; padding: 1.5rem 0; margin-bottom: 1.5rem; }
    .section-title { font-size: 1.125rem; font-weight: 600; color: #1f2937; margin-bottom: 0.75rem; }
    .info-box { background-color: #f0f9ff; border: 1px solid #bae6fd; border-radius: 0.5rem; padding: 1rem; }
    .info-title { color: #0369a1; font-weight: 600; margin-bottom: 0.5rem; }
    .active-iteration { background-color: #dcfce7 !important; }
    .nav-active { color: #1d4ed8; font-weight: 600; }
    .graph-section { background-color: #ffffff; border: 1px solid #dee2e6; border-radius: 0.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.05); overflow: hidden; }
    .graph-header { padding: 1rem; background-color: #f8f9fa; border-bottom: 1px solid #dee2e6; }
    .graph-controls { padding: 1rem; display: flex; justify-center; gap: 1rem; flex-wrap: wrap; background-color: #f8f9fa; border-bottom: 1px solid #dee2e6; }
    .graph-plot { height: 500px; }
    .error-message { background-color: #fee; color: #c00; padding: 0.5rem; border-radius: 0.25rem; font-size: 0.875rem; margin-top: 0.5rem; border: 1px solid #fcc; }
  </style>
</head>
<body class="bg-gray-50">
  <div class="fixed top-0 left-0 w-full z-10 nav-bar">
    <div class="max-w-7xl mx-auto px-6">
      <div class="flex justify-center">
        <ul class="flex space-x-6">
          <li><a href="index.html" class="nav-link">Home</a></li>
          <li><a href="teaching.html" class="nav-link">Teaching</a></li>
          <li><a href="projects.html" class="nav-link">Diff Eq</a></li>
          <li><a href="linear.html" class="nav-link">Linear Algebra</a></li>
          <li><a href="numerical.html" class="nav-link nav-active">Numerical Methods</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div class="container mt-24">
    <header class="header-section rounded-lg mb-6">
      <div class="text-center">
        <h1 class="text-3xl font-bold text-gray-800">Newton-Raphson Method Visualizer</h1>
        <p class="text-gray-600 text-base mt-2 max-w-3xl mx-auto">Interactive Newton-Raphson Method: Enter any function and watch the tangent line convergence in real-time.</p>
      </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
      <div class="lg:col-span-1 space-y-6">
        <div class="control-panel">
          <h3 class="text-base font-semibold text-gray-800 mb-4">Function Input</h3>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Enter Function f(x)</label>
              <input type="text" id="function-input" value="x^3 - 2*x + 2" class="w-full px-3 py-2 text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mono-font" placeholder="e.g., x^2 - 4">
              <div class="text-xs text-gray-500 mt-1">Examples: x^2 - 4, sin(x) - x/2, exp(x) - 2</div>
              <div id="function-error" class="error-message hidden"></div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Initial Guess x₀</label>
              <input type="number" id="x0" value="2" step="0.1" class="w-full px-3 py-2 text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Max Iterations</label>
              <input type="number" id="max-iterations" value="20" min="1" max="100" class="w-full px-3 py-2 text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Tolerance</label>
              <input type="text" id="tolerance" value="1e-10" class="w-full px-3 py-2 text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mono-font">
            </div>
            <button onclick="updateFunction()" class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors font-medium">
              Update Function
            </button>
          </div>
        </div>
      </div>

      <div class="lg:col-span-2 space-y-6">
        <div class="graph-section">
          <div class="graph-header">
            <div id="current-function" class="current-function w-full">f(x) = x³ - 2x + 2</div>
          </div>
          <div class="graph-controls">
            <button onclick="resetIterations()" class="btn-secondary py-2 px-6 rounded text-base font-medium">Reset</button>
            <button onclick="performIteration()" class="btn-primary py-2 px-6 rounded text-base font-medium">Step</button>
            <button id="animate-btn" onclick="toggleAnimation()" class="btn-success py-2 px-6 rounded text-base font-medium">Animate</button>
            <button id="stop-btn" onclick="stopAnimation()" class="btn-danger py-2 px-6 rounded text-base font-medium hidden">Stop</button>
          </div>
          <div class="graph-plot" id="graph"></div>
        </div>

        <div id="converged-message" class="converged-message">
          ✓ Convergence achieved!
        </div>

        <div class="info-box">
          <div class="info-title">Current Status</div>
          <div class="space-y-3">
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-700">Iteration:</span>
              <span id="current-iteration" class="text-base font-bold mono-font">0</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-700">Current x:</span>
              <span id="current-x" class="text-base font-bold mono-font">-</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-700">f(x):</span>
              <span id="current-fx" class="text-base font-bold mono-font">-</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="method-card mb-6">
      <h3 class="section-title">Newton's Method Formula</h3>
      <div class="text-center text-lg my-4" id="formula-display">
        $$ x_{n+1} = x_n - \frac{f(x_n)}{f'(x_n)} $$
      </div>
      <p class="text-sm text-gray-600 text-center">The derivative f'(x) is computed automatically using symbolic differentiation.</p>
    </div>

    <div id="iteration-table-container" class="bg-white rounded-lg border border-gray-200 p-6 shadow-sm mb-8">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">Iteration Details</h2>
      <div class="overflow-x-auto">
        <table class="w-full border-collapse compact-table">
          <thead>
            <tr class="bg-gray-50">
              <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-sm">n</th>
              <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-sm">x<sub>n</sub></th>
              <th class="border border-gray-300 px-3 py-2 text-left font-semibold text-sm">f(x<sub>n</sub>)</th>
            </tr>
          </thead>
          <tbody id="iteration-data"></tbody>
        </table>
      </div>
    </div>

    <div class="mt-8 pt-6 border-t border-gray-200 text-center text-gray-500 text-sm">
      <p class="mb-2">&copy; 2025 Shelvean Kapita: kapita@tamu.edu</p>
      <p class="mb-2">All code released under the <a href="https://opensource.org/licenses/MIT" class="text-blue-600 hover:underline">MIT License</a>.</p>
      <p>Last modified: January 24, 2026</p>
    </div>
  </div>

  <script>
    let functionExpr = 'x^3 - 2*x + 2';
    let derivativeExpr = null;
    let compiledF = null;
    let compiledDF = null;
    let iterations = [];
    let currentIteration = 0;
    let isAnimating = false;
    let plotInstance = null;
    let animationInterval = null;

    // Parse and compile function
    function updateFunction() {
      const input = document.getElementById('function-input').value.trim();
      const errorDiv = document.getElementById('function-error');

      try {
        // Parse the function
        const node = math.parse(input);
        functionExpr = input;

        // Compute derivative symbolically
        const derivative = math.derivative(node, 'x');
        derivativeExpr = derivative.toString();

        // Compile for fast evaluation
        compiledF = node.compile();
        compiledDF = derivative.compile();

        // Update display
        document.getElementById('current-function').textContent = `f(x) = ${input}`;
        errorDiv.classList.add('hidden');

        // Reset and redraw
        resetIterations();
        drawPlot();

      } catch (error) {
        errorDiv.textContent = `Error: ${error.message}`;
        errorDiv.classList.remove('hidden');
      }
    }

    function evaluateF(x) {
      return compiledF.evaluate({ x: x });
    }

    function evaluateDF(x) {
      return compiledDF.evaluate({ x: x });
    }

    function performIteration() {
      if (!compiledF || !compiledDF) {
        updateFunction();
        return;
      }

      const maxIter = parseInt(document.getElementById('max-iterations').value);
      const tolerance = parseFloat(document.getElementById('tolerance').value);

      if (currentIteration >= maxIter) {
        alert('Maximum iterations reached');
        return;
      }

      let x = currentIteration === 0 ?
        parseFloat(document.getElementById('x0').value) :
        iterations[currentIteration - 1].xNext;

      const fx = evaluateF(x);
      const dfx = evaluateDF(x);

      if (Math.abs(dfx) < 1e-14) {
        alert('Derivative too close to zero. Try a different initial guess.');
        return;
      }

      const xNext = x - fx / dfx;

      iterations.push({
        n: currentIteration,
        x: x,
        fx: fx,
        xNext: xNext
      });

      updateTable();
      drawPlot();
      updateStatus();

      currentIteration++;

      // Check convergence
      if (Math.abs(fx) < tolerance) {
        document.getElementById('converged-message').classList.add('show');
        stopAnimation();
      }
    }

    function resetIterations() {
      stopAnimation();
      iterations = [];
      currentIteration = 0;
      document.getElementById('iteration-data').innerHTML = '';
      document.getElementById('current-iteration').textContent = '0';
      document.getElementById('current-x').textContent = '-';
      document.getElementById('current-fx').textContent = '-';
      document.getElementById('converged-message').classList.remove('show');
      drawPlot();
    }

    function updateTable() {
      const tbody = document.getElementById('iteration-data');
      const iter = iterations[iterations.length - 1];

      const row = document.createElement('tr');
      row.className = currentIteration === iterations.length ? 'active-iteration' : '';
      row.innerHTML = `
        <td class="border border-gray-300 px-3 py-2">${iter.n}</td>
        <td class="border border-gray-300 px-3 py-2 mono-font">${iter.x.toExponential(6)}</td>
        <td class="border border-gray-300 px-3 py-2 mono-font">${iter.fx.toExponential(6)}</td>
      `;
      tbody.appendChild(row);

      // Remove previous highlights
      const rows = tbody.querySelectorAll('tr');
      rows.forEach((r, i) => {
        r.classList.toggle('active-iteration', i === rows.length - 1);
      });
    }

    function updateStatus() {
      const iter = iterations[iterations.length - 1];
      document.getElementById('current-iteration').textContent = iter.n;
      document.getElementById('current-x').textContent = iter.x.toExponential(6);
      document.getElementById('current-fx').textContent = iter.fx.toExponential(6);
    }

    function drawPlot() {
      if (!compiledF) return;

      try {
        // Auto-adjust bounds based on iterations
        let xMin = -5, xMax = 5, yMin = -10, yMax = 10;

        if (iterations.length > 0) {
          const xValues = iterations.map(it => it.x);
          const allX = [...xValues, iterations[iterations.length - 1].xNext];
          const minX = Math.min(...allX);
          const maxX = Math.max(...allX);
          const rangeX = Math.max(maxX - minX, 2);
          xMin = minX - rangeX * 0.5;
          xMax = maxX + rangeX * 0.5;

          // Sample function to get y range
          const samples = [];
          for (let x = xMin; x <= xMax; x += (xMax - xMin) / 50) {
            try {
              samples.push(evaluateF(x));
            } catch (e) {}
          }
          if (samples.length > 0) {
            const minY = Math.min(...samples);
            const maxY = Math.max(...samples);
            const rangeY = Math.max(maxY - minY, 2);
            yMin = minY - rangeY * 0.3;
            yMax = maxY + rangeY * 0.3;
          }
        }

        const data = [
          {
            fn: functionExpr,
            color: '#2563eb',
            graphType: 'polyline'
          }
        ];

        // Add tangent line for current iteration
        if (iterations.length > 0) {
          const current = iterations[iterations.length - 1];
          const x0 = current.x;
          const fx0 = current.fx;
          const slope = evaluateDF(x0);

          data.push({
            fn: `${fx0} + ${slope} * (x - ${x0})`,
            color: '#dc2626',
            graphType: 'polyline'
          });

          // Add points
          data.push({
            points: [[x0, fx0]],
            fnType: 'points',
            color: '#059669',
            graphType: 'scatter'
          });

          if (current.xNext !== undefined) {
            data.push({
              points: [[current.xNext, 0]],
              fnType: 'points',
              color: '#dc2626',
              graphType: 'scatter'
            });
          }
        }

        if (plotInstance) {
          plotInstance = functionPlot({
            target: '#graph',
            width: document.getElementById('graph').offsetWidth,
            height: 500,
            xAxis: { domain: [xMin, xMax] },
            yAxis: { domain: [yMin, yMax] },
            grid: true,
            data: data
          });
        } else {
          plotInstance = functionPlot({
            target: '#graph',
            width: document.getElementById('graph').offsetWidth,
            height: 500,
            xAxis: { domain: [xMin, xMax] },
            yAxis: { domain: [yMin, yMax] },
            grid: true,
            data: data
          });
        }
      } catch (error) {
        console.error('Plot error:', error);
      }
    }

    function toggleAnimation() {
      if (isAnimating) {
        stopAnimation();
      } else {
        startAnimation();
      }
    }

    function startAnimation() {
      isAnimating = true;
      document.getElementById('animate-btn').classList.add('hidden');
      document.getElementById('stop-btn').classList.remove('hidden');

      animationInterval = setInterval(() => {
        performIteration();
        const maxIter = parseInt(document.getElementById('max-iterations').value);
        const tolerance = parseFloat(document.getElementById('tolerance').value);

        if (currentIteration >= maxIter ||
            (iterations.length > 0 && Math.abs(iterations[iterations.length - 1].fx) < tolerance)) {
          stopAnimation();
        }
      }, 1000);
    }

    function stopAnimation() {
      isAnimating = false;
      document.getElementById('animate-btn').classList.remove('hidden');
      document.getElementById('stop-btn').classList.add('hidden');
      if (animationInterval) {
        clearInterval(animationInterval);
        animationInterval = null;
      }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', () => {
      // Render KaTeX
      renderMathInElement(document.body, {
        delimiters: [
          { left: "$$", right: "$$", display: true },
          { left: "$", right: "$", display: false }
        ],
        throwOnError: false
      });

      // Initialize function
      updateFunction();
    });

    // Handle window resize
    window.addEventListener('resize', () => {
      if (plotInstance) {
        drawPlot();
      }
    });
  </script>
</body>
</html>
