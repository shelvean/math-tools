<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="description" content="Change of Coordinates Matrix Calculator: Fractions/Decimals, Full LaTeX Steps, Complex Numbers">
  <meta name="keywords" content="Change of Coordinates, Transition Matrix, Linear Algebra, Complex, Fraction">
  <meta charset="UTF-8" />
  <title>Change of Coordinates Matrix Calculator</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LEQE004C92"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-LEQE004C92');
</script>
  <style>
    .katex-display { margin: 1em 0; }
    .matrix-container { display: flex; justify-content: center; gap: 2rem; }
    .katex { font-size: 1em; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <div class="nav-container w-full fixed top-0 z-10 bg-white shadow-md">
    <nav class="max-w-4xl mx-auto py-4">
      <ul class="flex justify-center gap-8">
        <li><a href="https://people.tamu.edu/~kapita/index.html" class="text-indigo-500 hover:text-blue-600 transition-colors font-bold text-xl">Home</a></li>
        <li><a href="https://people.tamu.edu/~kapita/teaching.html" class="text-indigo-500 hover:text-blue-600 transition-colors font-bold text-xl">Teaching</a></li>
        <li><a href="https://people.tamu.edu/~kapita/projects.html" class="text-indigo-500 hover:text-blue-600 font-bold text-xl">Diff Eq</a></li>
        <li><a href="https://people.tamu.edu/~kapita/linear.html" class="text-indigo-500 hover:text-blue-600 font-bold text-xl">Linear Algebra</a></li>
        <li><a href="https://people.tamu.edu/~kapita/numerical.html" class="text-indigo-500 hover:text-blue-600 font-bold text-xl">Numerical Methods</a></li>
      </ul>
    </nav>
  </div>
  <div class="bg-white p-6 rounded-lg shadow-md max-w-4xl w-full mt-16">
    <h2 class="text-2xl font-bold mb-4 text-center text-gray-800">Change of Coordinates Matrix Calculator</h2>
    <p class="text-center text-gray-600 mb-4">Given two bases $\mathcal{B} = \{v_1, \ldots, v_n\}$ and $\mathcal{C} = \{u_1, \ldots, u_n\}$ for $\mathbb{R}^n$, this calculator computes the <strong>change of coordinates matrix</strong> $\mathbf{S}$ that converts coordinates from basis $\mathcal{B}$ to basis $\mathcal{C}$.</p>

    <!-- About Change of Coordinates - Collapsible -->
    <div class="bg-blue-50 border border-blue-300 rounded-lg mb-6 overflow-hidden">
      <button onclick="toggleBasisConcepts()" class="w-full p-4 text-left flex items-center justify-between hover:bg-blue-100 transition duration-200">
        <h3 class="font-bold text-lg text-blue-800">About Change of Coordinates</h3>
        <span id="basisToggleIcon" class="text-blue-800 font-bold text-xl">−</span>
      </button>
      <div id="basisContent" class="px-4 pb-4">
        <p class="text-gray-700 mb-2 text-sm">The matrix $\mathbf{V}$ has columns $v_1, \ldots, v_n$ (initial basis vectors) and $\mathbf{U}$ has columns $u_1, \ldots, u_n$ (final basis vectors).</p>
        <p class="text-gray-700 mb-2"><strong>Change of Coordinates Matrix:</strong></p>
        <p class="text-center mb-3">$ \mathbf{S} = \mathbf{U}^{-1} \mathbf{V} $</p>
        <p class="text-gray-700 mb-2 text-sm">If $[\mathbf{x}]_{\mathcal{B}}$ represents coordinates in basis $\mathcal{B}$, then:</p>
        <p class="text-center mb-3">$ [\mathbf{x}]_{\mathcal{C}} = \mathbf{S} \, [\mathbf{x}]_{\mathcal{B}} $</p>
        <p class="text-gray-700 mb-2"><strong>Key Ideas:</strong></p>
        <ul class="text-gray-700 text-sm ml-6 list-disc">
          <li>$\mathbf{S}$ transforms coordinate vectors from basis $\mathcal{B}$ to basis $\mathcal{C}$</li>
          <li>The inverse $\mathbf{S}^{-1} = \mathbf{V}^{-1}\mathbf{U}$ goes from $\mathcal{C}$ back to $\mathcal{B}$</li>
          <li>If $\mathcal{C}$ is the standard basis, then $\mathbf{S} = \mathbf{V}$ converts to standard coordinates</li>
        </ul>
      </div>
    </div>

    <div id="inputSection" class="bg-gray-50 p-4 rounded-lg mb-6 flex justify-center items-center space-x-4">
      <span class="text-gray-700">Matrix size $n$:</span>
      <input type="number" id="size" min="1" required class="w-16 p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
      <button type="button" onclick="generateMatrices()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition duration-300">Generate Matrices</button>
      <button type="button" onclick="loadExample()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 transition duration-300">Load Example</button>
    </div>
    <div id="matrixInput" class="mb-6"></div>
    <div class="flex justify-center mb-6 space-x-6">
      <span class="text-gray-700">Display Values as:</span>
      <label class="flex items-center">
        <input type="radio" name="displayMode" value="fraction" checked class="mr-2">
        <span>Fraction</span>
      </label>
      <label class="flex items-center">
        <input type="radio" name="displayMode" value="decimal" class="mr-2">
        <span>Decimal</span>
      </label>
    </div>
    <div class="flex justify-center space-x-4 mb-6">
      <button id="calcBtn" type="button" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600 transition duration-300 w-1/3">Compute</button>
      <button id="clearBtn" type="button" class="bg-gray-500 text-white px-6 py-2 rounded hover:bg-gray-600 transition duration-300 w-1/3">Clear All</button>
    </div>
    <div id="result" class="mt-6 p-4 bg-gray-50 rounded-lg"></div>
    <div class="mt-6 border-t pt-4 text-center text-gray-500 text-sm">
    © 2025 Shelvean Kapita: kapita@tamu.edu <br>
    All code released under the MIT License. <br>
    Last modified: September 28, 2025
</div>
  </div>
  <script>
    // Initialize KaTeX rendering
    function renderKaTeX(element = document.body) {
      renderMathInElement(element, {
        delimiters: [
          { left: "$$", right: "$$", display: true },
          { left: "$", right: "$", display: false }
        ],
        throwOnError: false,
        strict: false,
        errorCallback: function(err) { console.error("KaTeX rendering error:", err); }
      });
    }
    document.addEventListener("DOMContentLoaded", () => renderKaTeX());

    function toggleBasisConcepts() {
      var content = document.getElementById("basisContent");
      var icon = document.getElementById("basisToggleIcon");
      if (content.style.display === "none") {
        content.style.display = "block";
        icon.textContent = "−";
      } else {
        content.style.display = "none";
        icon.textContent = "+";
      }
    }

    var currentDisplayMode = "fraction";
    document.querySelectorAll('input[name="displayMode"]').forEach(function(radio) {
      radio.addEventListener("change", function () {
        currentDisplayMode = this.value;
      });
    });

    // --- TRAILING ZERO STRIPPER ---
    function trimTrailingZeros(s) {
      return s.replace(/(\.\d*?[1-9])0+$/,'$1').replace(/\.0+$/,'').replace(/(\d)\.$/,'$1');
    }

    // --- COMPLEX NUMBERS ---
    function isNumber(x) {
      return typeof x === "number" && !isNaN(x);
    }

    class Complex {
      constructor(re, im) {
        this.re = +re;
        this.im = +im;
      }

      static parse(str) {
        let s = str.replace(/\s+/g, '').replace(/−/g, "-").replace(/pi/g, Math.PI).replace(/sqrt\((\d+)\)/g, (m, n) => Math.sqrt(+n)).replace(/cos\(pi\/(\d+)\)/g, (m, n) => Math.cos(Math.PI/+n));
        if (!s) return new Complex(0,0);
        if (/^[-+]?i$/.test(s)) {
          return new Complex(0, s[0]==="-"?-1:1);
        }
        let re = 0, im = 0;
        s = s.replace(/([\+\-]|^)(i)/g, (m, p1) => p1 + "1i");
        if (!s.includes('i')) {
          re = parseFraction(s);
          im = 0;
        } else if (s.endsWith('i')) {
          let parts = s.split(/(?=[+\-][^+\-]*i?$)/g).filter(Boolean);
          for (let part of parts) {
            if (part.endsWith('i')) im += parseFraction(part.replace('i',''));
            else re += parseFraction(part);
          }
        } else {
          throw Error("Invalid complex literal: " + str);
        }
        return new Complex(re, im);
      }

      clone() {
        return new Complex(this.re, this.im);
      }

      add(b) {
        return new Complex(this.re + b.re, this.im + b.im);
      }

      sub(b) {
        return new Complex(this.re - b.re, this.im - b.im);
      }

      neg() {
        return new Complex(-this.re, -this.im);
      }

      mul(b) {
        return new Complex(this.re * b.re - this.im * b.im, this.re * b.im + this.im * b.re);
      }

      div(b) {
        let den = b.re * b.re + b.im * b.im;
        if (den === 0) throw Error("Division by zero in complex number");
        let real = (this.re * b.re + this.im * b.im) / den;
        let imag = (this.im * b.re - this.re * b.im) / den;
        return new Complex(real, imag);
      }

      inv() {
        let den = this.re*this.re + this.im*this.im;
        if (den === 0) throw Error("Division by zero in complex inverse");
        return new Complex(this.re/den, -this.im/den);
      }

      abs() {
        return Math.sqrt(this.re*this.re + this.im*this.im);
      }

      isZero(eps) {
        eps = eps || 1e-10;
        return Math.abs(this.re) < eps && Math.abs(this.im) < eps;
      }

      equals(b, eps) {
        eps = eps || 1e-10;
        return Math.abs(this.re - b.re) < eps && Math.abs(this.im - b.im) < eps;
      }

      isReal(eps) {
        eps = eps || 1e-10;
        return Math.abs(this.im) < eps;
      }

      toString(decimals) {
        decimals = decimals ?? 3;
        let re = +this.re.toFixed(decimals);
        let im = +this.im.toFixed(decimals);
        let str = '';
        if (Math.abs(re) > 1e-10) str += re;
        if (Math.abs(im) > 1e-10) {
          if (im > 0 && str.length) str += '+';
          if (Math.abs(im-1) < 1e-10) str += 'i';
          else if (Math.abs(im+1) < 1e-10) str += '-i';
          else str += im +'i';
        }
        return str.length?str:'0';
      }

      toLaTeX(decimals, mode='decimal') {
        if (mode === 'fraction') {
          let reZero = Math.abs(this.re) < 1e-10;
          let imZero = Math.abs(this.im) < 1e-10;
          let re = reZero ? null : toFraction(this.re);
          let im = imZero ? null : toFraction(this.im);
          if (re && im) {
            let imStr = formatImaginaryFraction(im);
            let sign = imStr[0] === '-' ? '' : '+';
            return re + sign + imStr;
          } else if (re) {
            return re;
          } else if (im) {
            return formatImaginaryFraction(im);
          } else return '0';
        } else {
          let reZero = Math.abs(this.re) < 1e-10;
          let imZero = Math.abs(this.im) < 1e-10;
          let re = reZero ? null : trimTrailingZeros(this.re.toFixed(decimals ?? 3));
          let im = imZero ? null : trimTrailingZeros(this.im.toFixed(decimals ?? 3));
          if (re && im) {
            let sign = this.im>=0?'+':'';
            let imVal = parseFloat(im);
            if (Math.abs(imVal-1)<1e-10) im = 'i';
            else if (Math.abs(imVal+1)<1e-10) im = '-i';
            else im += 'i';
            return `${re}${sign}${im}`;
          } else if (re) {
            return re;
          } else if (im) {
            let imVal = parseFloat(im);
            if (Math.abs(imVal-1)<1e-10) return 'i';
            if (Math.abs(imVal+1)<1e-10) return '-i';
            return im+'i';
          } else return '0';
        }
      }
    }

    function toFraction(x, tolerance, maxIterations) {
      tolerance = tolerance || 1e-6;
      maxIterations = maxIterations || 20;
      if (!isFinite(x) || isNaN(x)) return "nan";
      if (Math.abs(x) < 1e-10) return "0";
      var sign = x < 0 ? "-" : "";
      x = Math.abs(x);
      var h1 = 1, h2 = 0, k1 = 0, k2 = 1, b = x;
      for (var i = 0; i < maxIterations; i++) {
        var a = Math.floor(b);
        var h = a * h1 + h2;
        var k = a * k1 + k2;
        if (Math.abs(x - h / k) < tolerance) {
          return k === 1 ? sign + h : sign + h + "/" + k;
        }
        h2 = h1; h1 = h;
        k2 = k1; k1 = k;
        b = 1 / (b - a);
      }
      return k1 === 1 ? sign + h1 : sign + h1 + "/" + k1;
    }

    function formatImaginaryFraction(im) {
      if (im === "0") return "";
      let isNeg = (im[0] === '-');
      let frac = isNeg ? im.slice(1) : im;
      let parts = frac.split('/');
      if (parts.length === 1) {
        if (Math.abs(+parts[0]-1) < 1e-10) return isNeg ? '-i' : 'i';
        else return (isNeg ? '-' : '') + parts[0] + 'i';
      }
      let numerator = parts[0], denominator = parts[1];
      if (Math.abs(+numerator) === 1) {
        return (isNeg ? '-' : '') + 'i/' + denominator;
      } else {
        return (isNeg?'':'') + numerator + 'i/' + denominator;
      }
    }

    function parseFraction(str) {
      str = str.trim();
      if (/^[+-]?(\d*\.)?\d+$/.test(str)) return parseFloat(str);
      if (/^[+-]?\d+\/\d+$/.test(str)) {
        let [num, den] = str.split('/');
        den = +den;
        if (den === 0) return NaN;
        return +num / den;
      }
      let f = parseFloat(str);
      if (!isNaN(f)) return f;
      return NaN;
    }

    function isZero(x) {
      if (x instanceof Complex) return x.isZero();
      return Math.abs(x) < 1e-10;
    }

    function generateMatrices() {
      var n = parseInt(document.getElementById("size").value, 10);
      if (isNaN(n) || n <= 0) {
        alert("Please enter a valid positive integer for matrix size.");
        return;
      }
      var matrixDiv = document.getElementById("matrixInput");
      matrixDiv.innerHTML = "";
      var statementDiv = document.createElement("div");
      statementDiv.className = "text-center mb-4";
      statementDiv.innerHTML = `Compute the change of coordinates matrix $$\\mathbf{S} = \\mathbf{U}^{-1} \\mathbf{V}$$`;
      matrixDiv.appendChild(statementDiv);

      var matricesContainer = document.createElement("div");
      matricesContainer.className = "matrix-container";

      // Matrix V (Initial Basis)
      var vDiv = document.createElement("div");
      vDiv.className = "flex flex-col items-center";
      var vLabel = document.createElement("p");
      vLabel.className = "text-center font-semibold";
      vLabel.innerHTML = "Matrix $$\\mathbf{V}$$ (Initial Basis)";
      vDiv.appendChild(vLabel);
      var vTable = document.createElement("table");
      vTable.className = "border-collapse";
      for (var i = 0; i < n; i++) {
        var tr = document.createElement("tr");
        for (var j = 0; j < n; j++) {
          var td = document.createElement("td");
          td.className = "p-1";
          var input = document.createElement("input");
          input.type = "text";
          input.className = "matrix-cell w-16 p-2 text-center border-2 border-gray-300 hover:border-blue-500 hover:border-4 rounded-md focus:outline-none";
          input.id = "vcell_" + i + "_" + j;
          td.appendChild(input);
          tr.appendChild(td);
        }
        vTable.appendChild(tr);
      }
      vDiv.appendChild(vTable);
      matricesContainer.appendChild(vDiv);

      // Matrix U (Final Basis)
      var uDiv = document.createElement("div");
      uDiv.className = "flex flex-col items-center";
      var uLabel = document.createElement("p");
      uLabel.className = "text-center font-semibold";
      uLabel.innerHTML = "Matrix $$\\mathbf{U}$$ (Final Basis)";
      uDiv.appendChild(uLabel);
      var uTable = document.createElement("table");
      uTable.className = "border-collapse";
      for (var i = 0; i < n; i++) {
        var tr = document.createElement("tr");
        for (var j = 0; j < n; j++) {
          var td = document.createElement("td");
          td.className = "p-1";
          var input = document.createElement("input");
          input.type = "text";
          input.className = "matrix-cell w-16 p-2 text-center border-2 border-gray-300 hover:border-blue-500 hover:border-4 rounded-md focus:outline-none";
          input.id = "ucell_" + i + "_" + j;
          td.appendChild(input);
          tr.appendChild(td);
        }
        uTable.appendChild(tr);
      }
      uDiv.appendChild(uTable);
      matricesContainer.appendChild(uDiv);

      matrixDiv.appendChild(matricesContainer);
      renderKaTeX(matrixDiv);
    }

    function clearAll() {
      document.getElementById("size").value = "";
      document.getElementById("matrixInput").innerHTML = "";
      document.getElementById("result").innerHTML = "";
      document.querySelector('input[value="fraction"]').checked = true;
      currentDisplayMode = "fraction";
      renderKaTeX();
    }

    document.getElementById("clearBtn").addEventListener("click", clearAll);

    function readMatrix(prefix) {
      var n = parseInt(document.getElementById("size").value, 10);
      if (isNaN(n) || n <= 0) return null;
      var matrix = [];
      for (var i = 0; i < n; i++) {
        var row = [];
        for (var j = 0; j < n; j++) {
          var cell = document.getElementById(prefix + "cell_" + i + "_" + j);
          var value = cell.value.trim();
          var num;
          try {
            num = value === "" ? new Complex(0, 0) : Complex.parse(value);
          } catch(e) {
            alert("Invalid input for cell ("+(i+1)+","+(j+1)+") in matrix " + (prefix === 'u' ? 'U' : 'V') + ": " + value);
            return null;
          }
          row.push(num);
        }
        matrix.push(row);
      }
      return matrix;
    }

    function cloneMatrix(matrix) {
      return matrix.map(function(row) { return row.map(v => v.clone()); });
    }

    function formatComplexLatex(z) {
      return z.toLaTeX(3, currentDisplayMode);
    }

    function matrixToLatex(matrix) {
      if (!matrix.length || !matrix[0].length) return "";
      var n = matrix.length;
      var totalCols = matrix[0].length;
      var colSpec = "";
      for (var i = 0; i < n; i++) colSpec += "c";
      if (totalCols > n) colSpec += "|";
      for (var i = n; i < totalCols; i++) colSpec += "c";
      var latex = "\\left[ \\begin{array}{" + colSpec + "}\n";
      latex += matrix.map(function(row){ return row.map(formatComplexLatex).join(" & "); }).join(" \\\\ \n");
      latex += "\n\\end{array} \\right]";
      return latex;
    }

    function isRowZero(matrix, row, n, eps = 1e-12) {
      for (let j = 0; j < n; j++) {
        if (!matrix[row][j].isZero(eps)) return false;
      }
      return true;
    }

    function isColumnZero(matrix, col, n, eps = 1e-12) {
      for (let i = 0; i < n; i++) {
        if (!matrix[i][col].isZero(eps)) return false;
      }
      return true;
    }

    function computeChangeOfCoordinates(uMatrix, vMatrix) {
      const n = uMatrix.length;
      if (n === 0) return { result: [], steps: [], isSingular: false };
      const augmented = uMatrix.map((row, i) => [
        ...row.map(z => z.clone()),
        ...vMatrix[i].map(z => z.clone())
      ]);
      const steps = [];
      steps.push({ descLaTeX: `\\text{Initial Augmented Matrix } [\\mathbf{U} | \\mathbf{V}]:`, matrix: cloneMatrix(augmented) });

      for (let r = 0; r < n; r++) {
        for (let i = 0; i < n; i++) {
          if (isRowZero(augmented, i, n)) {
            steps.push({ descLaTeX: `\\text{Matrix } \\mathbf{U} \\text{ is singular (row ${i + 1} is zero)}`, matrix: cloneMatrix(augmented) });
            return { result: augmented, steps: steps, isSingular: true };
          }
        }
        for (let j = 0; j < n; j++) {
          if (isColumnZero(augmented, j, n)) {
            steps.push({ descLaTeX: `\\text{Matrix } \\mathbf{U} \\text{ is singular (column ${j + 1} is zero)}`, matrix: cloneMatrix(augmented) });
            return { result: augmented, steps: steps, isSingular: true };
          }
        }
        let maxRow = r;
        let maxVal = 0;
        for (let i = r; i < n; ++i) {
          var val = augmented[i][r].abs();
          if (val > maxVal) {
            maxVal = val;
            maxRow = i;
          }
        }
        if (maxVal < 1e-12) {
          steps.push({ descLaTeX: `\\text{Matrix } \\mathbf{U} \\text{ is singular (zero pivot in column ${r + 1})}`, matrix: cloneMatrix(augmented) });
          return { result: augmented, steps: steps, isSingular: true };
        }
        if (maxRow !== r) {
          const tmp = augmented[r];
          augmented[r] = augmented[maxRow];
          augmented[maxRow] = tmp;
          steps.push({ descLaTeX: `\\text{Swap row ${r + 1} with row ${maxRow + 1}:} \\qquad R_{${r + 1}} \\leftrightarrow R_{${maxRow + 1}}`, matrix: cloneMatrix(augmented) });
        }
        let pivot = augmented[r][r].clone();
        if (pivot.isZero()) {
          steps.push({ descLaTeX: `\\text{Matrix } \\mathbf{U} \\text{ is singular (zero pivot found)}`, matrix: cloneMatrix(augmented) });
          return { result: augmented, steps: steps, isSingular: true };
        }
        if (!pivot.equals(new Complex(1, 0))) {
          let factor = pivot.inv();
          let parenFactor = "(" + factor.toLaTeX(3, currentDisplayMode) + ")";
          let descLatex = `\\text{Scale row ${r + 1} by }${parenFactor}:\\qquad ${parenFactor} R_{${r + 1}} \\to R_{${r + 1}}`;
          for (let j = 0; j < 2 * n; ++j) augmented[r][j] = augmented[r][j].mul(factor);
          steps.push({ descLaTeX: descLatex, matrix: cloneMatrix(augmented) });
        }
        for (let i = 0; i < n; ++i) if (i !== r) {
          let factor = augmented[i][r].clone();
          if (!factor.isZero()) {
            for (let j = 0; j < 2 * n; ++j) {
              augmented[i][j] = augmented[i][j].sub(factor.mul(augmented[r][j]));
            }
            let fStr = factor.toLaTeX(3, currentDisplayMode);
            steps.push({ descLaTeX: `\\text{Replace row ${i + 1} by:}\\qquad R_{${i + 1}} - (${fStr})\\, R_{${r + 1}} \\to R_{${i + 1}}`, matrix: cloneMatrix(augmented) });
          }
        }
      }
      steps.push({ descLaTeX: `\\text{Final Augmented Matrix } [\\mathbf{I} | \\mathbf{S}]:`, matrix: cloneMatrix(augmented) });
      return { result: augmented, steps: steps, isSingular: false };
    }

    function sideBySideLatex(initMat, finalMat) {
      return "\\begin{array}{ccc}" + matrixToLatex(initMat) + " & \\xrightarrow{\\text{row ops}} & " + matrixToLatex(finalMat) + "\\end{array}";
    }

    function extractTransitionMatrix(matrix) {
      const n = matrix.length;
      const transition = [];
      for (let i = 0; i < n; i++) {
        transition.push(matrix[i].slice(n));
      }
      return transition;
    }

    function renderSteps(steps, uMatrix, vMatrix) {
      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = "";
      if (steps.length >= 1 && steps[0].matrix) {
        const isSingular = steps[steps.length - 1].descLaTeX.includes("singular");

        // Transition Matrix Section
        const transitionHeaderDiv = document.createElement("div");
        transitionHeaderDiv.className = "mb-2";
        transitionHeaderDiv.innerHTML = "$$\\textbf{Change of Coordinates Matrix:}$$";
        resultDiv.appendChild(transitionHeaderDiv);

        const transitionSpacerDiv = document.createElement("div");
        transitionSpacerDiv.className = "my-4";
        resultDiv.appendChild(transitionSpacerDiv);

        const transitionDiv = document.createElement("div");
        transitionDiv.className = "mb-6";
        if (isSingular) {
          transitionDiv.innerHTML = "$$\\mathbf{S} \\text{ does not exist (}\\mathbf{U} \\text{ is singular)}$$";
        } else {
          const transitionMat = extractTransitionMatrix(steps[steps.length - 1].matrix);
          transitionDiv.innerHTML = "$$\\mathbf{S} = \\mathbf{U}^{-1} \\mathbf{V} = " + matrixToLatex(transitionMat) + "$$";
        }
        resultDiv.appendChild(transitionDiv);

        const sectionSpacerDiv = document.createElement("div");
        sectionSpacerDiv.className = "my-4";
        resultDiv.appendChild(sectionSpacerDiv);

        const sbsHeaderDiv = document.createElement("div");
        sbsHeaderDiv.className = "mb-2";
        sbsHeaderDiv.innerHTML = "$$\\textbf{Initial and Final Augmented Matrices:}$$";
        resultDiv.appendChild(sbsHeaderDiv);

        const sbsSpacerDiv = document.createElement("div");
        sbsSpacerDiv.className = "my-4";
        resultDiv.appendChild(sbsSpacerDiv);

        const sbsDiv = document.createElement("div");
        sbsDiv.className = "mb-6";
        sbsDiv.innerHTML = "$$" + sideBySideLatex(steps[0].matrix, steps[steps.length - 1].matrix) + "$$";
        resultDiv.appendChild(sbsDiv);

        const inputHeaderDiv = document.createElement("div");
        inputHeaderDiv.className = "mb-2";
        inputHeaderDiv.innerHTML = "$$\\textbf{Input Matrices:}$$";
        resultDiv.appendChild(inputHeaderDiv);

        const inputSpacerDiv = document.createElement("div");
        inputSpacerDiv.className = "my-4";
        resultDiv.appendChild(inputSpacerDiv);

        const inputDiv = document.createElement("div");
        inputDiv.className = "mb-6";
        inputDiv.innerHTML = "$$\\begin{array}{ccc} \\mathbf{V} = " + matrixToLatex(vMatrix) + " & \\quad & \\mathbf{U} = " + matrixToLatex(uMatrix) + " \\end{array}$$";
        resultDiv.appendChild(inputDiv);

        const stepsHeader = document.createElement("div");
        stepsHeader.className = "mb-4";
        stepsHeader.innerHTML = "$$\\textbf{Transformation Steps:}$$";
        resultDiv.appendChild(stepsHeader);

        steps.forEach((step, i) => {
          const stepDiv = document.createElement("div");
          stepDiv.className = "mb-6 border-b pb-4";
          if (step.descLaTeX) {
            const descDiv = document.createElement("div");
            descDiv.className = "mb-4";
            descDiv.innerHTML = "$$" + step.descLaTeX + "$$";
            stepDiv.appendChild(descDiv);
          }
          if (step.matrix) {
            const matrixDiv = document.createElement("div");
            matrixDiv.innerHTML = "$$" + matrixToLatex(step.matrix) + "$$";
            stepDiv.appendChild(matrixDiv);
          }
          resultDiv.appendChild(stepDiv);
        });

        renderKaTeX(resultDiv);
      }
    }

    document.getElementById("calcBtn").addEventListener("click", function () {
      const uMatrix = readMatrix("u");
      const vMatrix = readMatrix("v");
      if (uMatrix !== null && vMatrix !== null) {
        const computation = computeChangeOfCoordinates(uMatrix, vMatrix);
        renderSteps(computation.steps, uMatrix, vMatrix);
      }
    });

    function loadExample() {
      // Set size to 2 and generate matrices
      document.getElementById("size").value = "2";
      generateMatrices();

      // Wait for matrices to be generated, then populate with example values
      setTimeout(() => {
        // V matrix (initial basis): [[2, 1], [1, 2]]
        document.getElementById("vcell_0_0").value = "2";
        document.getElementById("vcell_0_1").value = "1";
        document.getElementById("vcell_1_0").value = "1";
        document.getElementById("vcell_1_1").value = "2";

        // U matrix (final basis): [[1, 1], [1, -1]]
        document.getElementById("ucell_0_0").value = "1";
        document.getElementById("ucell_0_1").value = "1";
        document.getElementById("ucell_1_0").value = "1";
        document.getElementById("ucell_1_1").value = "-1";

        // Add example explanation
        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = `
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
            <h3 class="font-bold text-lg mb-2 text-blue-800">Example Loaded:</h3>
            <p class="text-gray-700 mb-2">This example computes the change of coordinates from basis $\\mathcal{B}$ to basis $\\mathcal{C}$ in $\\mathbb{R}^2$:</p>
            <p class="text-gray-700">$\\mathcal{B} = \\left\\{ \\begin{pmatrix} 2 \\\\ 1 \\end{pmatrix}, \\begin{pmatrix} 1 \\\\ 2 \\end{pmatrix} \\right\\}$ (initial basis)</p>
            <p class="text-gray-700 mb-2">$\\mathcal{C} = \\left\\{ \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}, \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} \\right\\}$ (final basis)</p>
            <p class="text-gray-700 mt-3 text-sm italic">Click "Compute" to see the change of coordinates matrix $\\mathbf{S} = \\mathbf{U}^{-1} \\mathbf{V}$ and all transformation steps.</p>
          </div>
        `;
        renderKaTeX(resultDiv);
      }, 100);
    }
  </script>
</body>

</html>

