<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LEQE004C92"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-LEQE004C92');
</script>
  <title>Geometry of Linear Systems in 2D</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
    MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] } };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" crossorigin="anonymous"></script>
  <style>
    .axis line {
      stroke: #666;
      stroke-width: 1.5px;
    }
    .axis text {
      font-size: 12px;
      fill: #333;
      font-family: Arial, sans-serif;
    }
    .grid line {
      stroke: #e0e0e0;
      stroke-width: 0.5px;
      shape-rendering: crispEdges;
    }
    .grid path {
      stroke-width: 0;
    }
    .vector-arrow {
      stroke-width: 2.5px;
      fill: none;
      stroke-linecap: round;
      stroke-linejoin: round;
    }
    .line-plot {
      stroke-width: 2.5px;
      fill: none;
      stroke-linecap: round;
    }
    .solution-point {
      fill: #000;
      stroke: #fff;
      stroke-width: 2px;
    }
    .vector-label {
      font-size: 16px;
      font-weight: bold;
      pointer-events: none;
      text-shadow: 0 0 3px white, 0 0 3px white, 0 0 3px white;
    }
    #plot-svg {
      border: 2px solid #d1d5db;
      border-radius: 8px;
      background: white;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .zoom-controls {
      position: absolute;
      top: 10px;
      right: 10px;
      display: flex;
      flex-direction: column;
      gap: 5px;
      z-index: 10;
    }
    .zoom-btn {
      width: 36px;
      height: 36px;
      background: white;
      border: 2px solid #3b82f6;
      border-radius: 6px;
      font-size: 20px;
      font-weight: bold;
      color: #3b82f6;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .zoom-btn:hover {
      background: #3b82f6;
      color: white;
    }
    .zoom-hint {
      position: absolute;
      bottom: 10px;
      left: 10px;
      background: rgba(255, 255, 255, 0.9);
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 12px;
      color: #666;
      border: 1px solid #ddd;
      pointer-events: none;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 font-sans antialiased">
  <nav class="fixed top-0 left-0 w-full z-20 bg-white shadow-md">
    <div class="max-w-4xl mx-auto px-4 py-2">
      <ul class="flex justify-center space-x-4">
        <li><a href="index.html" class="text-indigo-500 hover:text-blue-600 font-bold text-xl">Home</a></li>
        <li><a href="teaching.html" class="text-indigo-500 hover:text-blue-600 font-bold text-xl">Teaching</a></li>
        <li><a href="projects.html" class="text-indigo-500 hover:text-blue-600 font-bold text-xl">Diff Eq</a></li>
        <li><a href="linear.html" class="text-indigo-500 hover:text-blue-600 font-bold text-xl">Linear Algebra</a></li>
        <li><a href="numerical.html" class="text-indigo-500 hover:text-blue-600 font-bold text-xl">Numerical Methods</a></li>
      </ul>
    </div>
  </nav>
  <h1 class="text-4xl text-center text-blue-600 font-bold mt-16 mb-6">Geometry of Linear Systems in 2D</h1>
  <div class="relative w-[800px] h-[600px] mx-auto mb-4">
    <svg id="plot-svg" width="800" height="600"></svg>
    <div class="zoom-controls">
      <button class="zoom-btn" id="zoom-in" title="Zoom In">+</button>
      <button class="zoom-btn" id="zoom-out" title="Zoom Out">âˆ’</button>
      <button class="zoom-btn" id="zoom-reset" title="Reset View" style="font-size: 16px;">âŸ²</button>
    </div>
    <div class="zoom-hint">
      ðŸ’¡ Use mouse wheel to zoom â€¢ Drag to pan
    </div>
  </div>
  <div id="solution-info" class="text-center mt-5 text-xl"></div>
  <div class="flex flex-wrap justify-center gap-4 max-w-5xl mx-auto mt-5 px-4">
    <div class="w-full md:w-[30%] min-w-[250px] bg-white p-3 border border-gray-200 rounded-lg shadow-sm">
      <h3 class="text-lg font-semibold text-gray-600 mb-2 text-center">Vector Input</h3>
      <div class="flex space-x-4">
        <div class="flex-1">
          <div class="flex items-center mb-2">
            <span class="mathjax-label mr-2 text-base" id="v1-label"></span>
          </div>
          <div class="flex items-center mb-2">
            <span class="mathjax-label w-8 text-center mr-1" id="c1-coeff-label"></span>
            <input type="number" id="c1" placeholder="câ‚" step="any" value="3" class="border border-gray-300 rounded p-2 w-20 text-sm">
          </div>
          <div class="flex items-center mb-2">
            <span class="mathjax-label w-8 text-center mr-1" id="v1x-label"></span>
            <input type="number" id="vec1x" placeholder="xâ‚" step="any" value="2" class="border border-gray-300 rounded p-2 w-20 text-sm">
          </div>
          <div class="flex items-center mb-2">
            <span class="mathjax-label w-8 text-center mr-1" id="v1y-label"></span>
            <input type="number" id="vec1y" placeholder="yâ‚" step="any" value="4" class="border border-gray-300 rounded p-2 w-20 text-sm">
          </div>
        </div>
        <div class="flex-1">
          <div class="flex items-center mb-2">
            <span class="mathjax-label mr-2 text-base" id="v2-label"></span>
          </div>
          <div class="flex items-center mb-2">
            <span class="mathjax-label w-8 text-center mr-1" id="c2-coeff-label"></span>
            <input type="number" id="c2" placeholder="câ‚‚" step="any" value="2" class="border border-gray-300 rounded p-2 w-20 text-sm">
          </div>
          <div class="flex items-center mb-2">
            <span class="mathjax-label w-8 text-center mr-1" id="v2x-label"></span>
            <input type="number" id="vec2x" placeholder="xâ‚‚" step="any" value="1" class="border border-gray-300 rounded p-2 w-20 text-sm">
          </div>
          <div class="flex items-center mb-2">
            <span class="mathjax-label w-8 text-center mr-1" id="v2y-label"></span>
            <input type="number" id="vec2y" placeholder="yâ‚‚" step="any" value="-3" class="border border-gray-300 rounded p-2 w-20 text-sm">
          </div>
        </div>
      </div>
      <button id="showAddition" class="w-full bg-blue-600 text-white py-1 rounded hover:bg-blue-700 transition-colors">Show Linear Combination</button>
    </div>
    <div class="w-full md:w-[30%] min-w-[250px] bg-white p-3 border border-gray-200 rounded-lg shadow-sm">
      <h3 class="text-lg font-semibold text-gray-600 mb-2">System of Equations</h3>
      <div class="mb-2">
        <span class="mathjax-label mr-2 text-base" id="l1-label"></span>
        <input type="text" id="eq1" placeholder="2x + y = 8" value="2x + y = 8" class="border border-gray-300 rounded p-2 w-40 text-sm">
      </div>
      <div class="mb-2">
        <span class="mathjax-label mr-2 text-base" id="l2-label"></span>
        <input type="text" id="eq2" placeholder="4x - 3y = 6" value="4x - 3y = 6" class="border border-gray-300 rounded p-2 w-40 text-sm">
      </div>
      <button id="solveSystem" class="w-full bg-blue-600 text-white py-1 rounded hover:bg-blue-700 transition-colors">Solve System</button>
    </div>
  </div>
  <footer class="text-center text-gray-500 text-sm mt-6 mb-4">
    &copy; Shelvean Kapita. All code released under the MIT License. Last Modified: January 18, 2026
  </footer>
  <script>
    // Utility functions
    function displayError(message) {
      const solutionInfo = document.getElementById('solution-info');
      solutionInfo.innerHTML = `<span class="text-red-500 text-lg">${message}</span>`;
    }

    function formatCoefficient(c) {
      if (c === 1) return '';
      if (c === -1) return '-';
      if (Number.isInteger(c)) return c.toString();
      return c.toFixed(2);
    }

    function formatCoordinate(v) {
      if (Number.isInteger(v)) return v.toString();
      return v.toFixed(2);
    }

    // Initialize MathJax labels
    function renderMathJaxLabels() {
      const labels = {
        'v1-label': '\\( \\mathbf{v_1} = \\begin{bmatrix} x_1 \\\\ y_1 \\end{bmatrix} \\)',
        'v2-label': '\\( \\mathbf{v_2} = \\begin{bmatrix} x_2 \\\\ y_2 \\end{bmatrix} \\)',
        'c1-coeff-label': '\\( c_1 \\)',
        'c2-coeff-label': '\\( c_2 \\)',
        'v1x-label': '\\( x_1 \\)',
        'v1y-label': '\\( y_1 \\)',
        'v2x-label': '\\( x_2 \\)',
        'v2y-label': '\\( y_2 \\)',
        'l1-label': '\\( \\mathbf{L_1}: \\)',
        'l2-label': '\\( \\mathbf{L_2}: \\)'
      };
      Object.keys(labels).forEach(id => {
        document.getElementById(id).innerHTML = labels[id];
      });
      if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
        MathJax.typesetPromise(Object.keys(labels).map(id => `#${id}`)).catch(err => {
          console.warn('MathJax failed to render:', err);
        });
      }
    }

    // D3 Setup
    const width = 800;
    const height = 600;
    const margin = {top: 20, right: 20, bottom: 40, left: 50};

    const svg = d3.select('#plot-svg');

    // Create zoom behavior
    const zoom = d3.zoom()
      .scaleExtent([0.5, 20])
      .on('zoom', (event) => {
        g.attr('transform', event.transform);
      });

    svg.call(zoom);

    // Create main group for zoom/pan
    const g = svg.append('g');

    // Create scales
    let xScale = d3.scaleLinear()
      .domain([-20, 20])
      .range([0, width]);

    let yScale = d3.scaleLinear()
      .domain([-15, 15])
      .range([height, 0]);

    // Create axes
    const xAxis = d3.axisBottom(xScale).ticks(20);
    const yAxis = d3.axisLeft(yScale).ticks(15);

    // Grid
    const xGrid = d3.axisBottom(xScale).tickSize(-height).tickFormat('').ticks(40);
    const yGrid = d3.axisLeft(yScale).tickSize(-width).tickFormat('').ticks(30);

    // Append grid
    const gridG = g.append('g').attr('class', 'grid-group');
    gridG.append('g')
      .attr('class', 'grid')
      .attr('transform', `translate(0,${height})`)
      .call(xGrid);
    gridG.append('g')
      .attr('class', 'grid')
      .call(yGrid);

    // Append axes
    const axesG = g.append('g').attr('class', 'axes-group');
    axesG.append('g')
      .attr('class', 'axis x-axis')
      .attr('transform', `translate(0,${yScale(0)})`)
      .call(xAxis);
    axesG.append('g')
      .attr('class', 'axis y-axis')
      .attr('transform', `translate(${xScale(0)},0)`)
      .call(yAxis);

    // Container for plot elements
    const plotG = g.append('g').attr('class', 'plot-group');
    const labelsG = g.append('g').attr('class', 'labels-group');

    // Draw arrow helper
    function drawArrow(group, x1, y1, x2, y2, color, label, isLatex = false) {
      const dx = x2 - x1;
      const dy = y2 - y1;
      const length = Math.sqrt(dx * dx + dy * dy);

      if (length < 0.01) return;

      const path = group.append('path')
        .attr('class', 'vector-arrow')
        .attr('d', () => {
          const arrowLength = 0.6;
          const angle = Math.atan2(dy, dx);
          const arrowAngle = Math.PI / 6;

          const headX = x2;
          const headY = y2;
          const p1x = headX - arrowLength * Math.cos(angle - arrowAngle);
          const p1y = headY - arrowLength * Math.sin(angle - arrowAngle);
          const p2x = headX - arrowLength * Math.cos(angle + arrowAngle);
          const p2y = headY - arrowLength * Math.sin(angle + arrowAngle);

          return `M ${xScale(x1)},${yScale(y1)} L ${xScale(x2)},${yScale(y2)} M ${xScale(headX)},${yScale(headY)} L ${xScale(p1x)},${yScale(p1y)} M ${xScale(headX)},${yScale(headY)} L ${xScale(p2x)},${yScale(p2y)}`;
        })
        .attr('stroke', color);

      if (label) {
        const offset = 15;
        const foreignObj = labelsG.append('foreignObject')
          .attr('x', xScale(x2) + offset - 30)
          .attr('y', yScale(y2) - offset - 15)
          .attr('width', 100)
          .attr('height', 40)
          .attr('class', 'label-container');

        const labelDiv = foreignObj.append('xhtml:div')
          .style('color', color)
          .style('font-size', '16px')
          .style('font-weight', 'bold')
          .style('background', 'rgba(255, 255, 255, 0.9)')
          .style('padding', '2px 6px')
          .style('border-radius', '4px')
          .style('text-shadow', '0 0 3px white')
          .style('white-space', 'nowrap');

        if (isLatex) {
          labelDiv.html(`\\(${label}\\)`);
        } else {
          labelDiv.html(label);
        }
      }
    }

    // Clear plot
    function clearPlot() {
      plotG.selectAll('*').remove();
      labelsG.selectAll('*').remove();
    }

    // Draw linear combination
    function drawLinearCombination(v1, v2, c1, c2) {
      clearPlot();

      const scaledV1 = {x: c1 * v1.x, y: c1 * v1.y};
      const scaledV2 = {x: c2 * v2.x, y: c2 * v2.y};
      const sum = {x: scaledV1.x + scaledV2.x, y: scaledV1.y + scaledV2.y};

      // Draw parallelogram if both vectors are non-zero
      if ((scaledV1.x !== 0 || scaledV1.y !== 0) && (scaledV2.x !== 0 || scaledV2.y !== 0)) {
        plotG.append('path')
          .attr('d', `M ${xScale(0)},${yScale(0)} L ${xScale(scaledV1.x)},${yScale(scaledV1.y)} L ${xScale(sum.x)},${yScale(sum.y)} L ${xScale(scaledV2.x)},${yScale(scaledV2.y)} Z`)
          .attr('fill', 'rgba(59, 130, 246, 0.15)')
          .attr('stroke', 'rgba(59, 130, 246, 0.3)')
          .attr('stroke-width', 1);
      }

      // Draw vectors - create LaTeX labels
      const v1LatexLabel = c1 === 1 ? '\\mathbf{v_1}' : c1 === -1 ? '-\\mathbf{v_1}' : `${formatCoefficient(c1)} \\mathbf{v_1}`;
      const v2LatexLabel = c2 === 1 ? '\\mathbf{v_2}' : c2 === -1 ? '-\\mathbf{v_2}' : `${formatCoefficient(c2)} \\mathbf{v_2}`;

      const terms = [];
      if (c1 !== 0) terms.push(c1 === -1 ? '-\\mathbf{v_1}' : c1 === 1 ? '\\mathbf{v_1}' : `${formatCoefficient(c1)} \\mathbf{v_1}`);
      if (c2 !== 0) terms.push(c2 === -1 ? '-\\mathbf{v_2}' : c2 === 1 ? '\\mathbf{v_2}' : `${formatCoefficient(c2)} \\mathbf{v_2}`);
      let sumLabel = terms.length > 0 ? '' : '0';
      for (let i = 0; i < terms.length; i++) {
        if (i === 0) {
          sumLabel += terms[i];
        } else {
          sumLabel += terms[i].startsWith('-') ? ` ${terms[i]}` : ` + ${terms[i]}`;
        }
      }

      if (c1 !== 0) drawArrow(plotG, 0, 0, scaledV1.x, scaledV1.y, '#b91c1c', v1LatexLabel, true);
      if (c2 !== 0) drawArrow(plotG, 0, 0, scaledV2.x, scaledV2.y, '#1e40af', v2LatexLabel, true);
      if (sum.x !== 0 || sum.y !== 0) drawArrow(plotG, 0, 0, sum.x, sum.y, '#000', sumLabel, true);

      document.getElementById('solution-info').innerHTML = `Linear Combination: \\(${sumLabel} = \\begin{bmatrix} ${formatCoordinate(sum.x)} \\\\ ${formatCoordinate(sum.y)} \\end{bmatrix}\\)`;

      if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
        MathJax.typesetPromise(['#solution-info', '#plot-svg']).catch(err => console.warn('MathJax error:', err));
      }
    }

    // Parse equation
    function parseEquation(equation) {
      if (!equation) throw new Error('Equation cannot be empty.');
      equation = equation.replace(/\s+/g, '');
      const sides = equation.split('=');
      if (sides.length !== 2) throw new Error('Invalid equation: must contain exactly one "=".');
      const left = sides[0];
      const right = sides[1];
      const c = parseFloat(right);
      if (isNaN(c)) throw new Error('Invalid constant term: right side must be a number.');
      const terms = left.match(/([+-]?\d*\.?\d*[xy]?)/g)?.filter(term => term !== '') || [];
      if (terms.length === 0) throw new Error('No valid terms found in equation.');
      let a = 0, b = 0, leftConstant = 0;
      terms.forEach(term => {
        if (term.endsWith('x')) {
          const coeffStr = term.slice(0, -1);
          a += (coeffStr === '' || coeffStr === '+') ? 1 : (coeffStr === '-') ? -1 : parseFloat(coeffStr);
        } else if (term.endsWith('y')) {
          const coeffStr = term.slice(0, -1);
          b += (coeffStr === '' || coeffStr === '+') ? 1 : (coeffStr === '-') ? -1 : parseFloat(coeffStr);
        } else {
          const val = (term === '+' || term === '-') ? (term === '+' ? 1 : -1) : parseFloat(term);
          if (!isNaN(val)) leftConstant += val;
        }
      });
      if (isNaN(a) || isNaN(b) || isNaN(leftConstant)) throw new Error('Invalid coefficients in equation.');
      return { a, b, c: c - leftConstant };
    }

    // Solve system
    function solveSystem() {
      try {
        const eq1 = document.getElementById('eq1').value.trim();
        const eq2 = document.getElementById('eq2').value.trim();
        const line1 = parseEquation(eq1);
        const line2 = parseEquation(eq2);
        const { a: a1, b: b1, c: c1 } = line1;
        const { a: a2, b: b2, c: c2 } = line2;

        clearPlot();

        const D = a1 * b2 - a2 * b1;
        const D_x = c1 * b2 - c2 * b1;
        const D_y = a1 * c2 - a2 * c1;

        const xDomain = xScale.domain();
        const yDomain = yScale.domain();
        const minX = xDomain[0];
        const maxX = xDomain[1];
        const minY = yDomain[0];
        const maxY = yDomain[1];

        // Draw line helper
        function drawLine(a, b, c, color, label) {
          const points = [];

          if (Math.abs(b) < 1e-10) {
            // Vertical line
            if (Math.abs(a) > 1e-10) {
              const x = c / a;
              points.push([x, minY], [x, maxY]);
            }
          } else {
            // y = (c - ax) / b
            const y1 = (c - a * minX) / b;
            const y2 = (c - a * maxX) / b;
            if (y1 >= minY && y1 <= maxY) points.push([minX, y1]);
            if (y2 >= minY && y2 <= maxY) points.push([maxX, y2]);

            if (points.length < 2) {
              const x1 = (c - b * minY) / a;
              const x2 = (c - b * maxY) / a;
              if (x1 >= minX && x1 <= maxX) points.push([x1, minY]);
              if (x2 >= minX && x2 <= maxX) points.push([x2, maxY]);
            }
          }

          if (points.length >= 2) {
            plotG.append('line')
              .attr('class', 'line-plot')
              .attr('x1', xScale(points[0][0]))
              .attr('y1', yScale(points[0][1]))
              .attr('x2', xScale(points[1][0]))
              .attr('y2', yScale(points[1][1]))
              .attr('stroke', color);

            const foreignObj = labelsG.append('foreignObject')
              .attr('x', xScale(points[0][0]) + 15 - 20)
              .attr('y', yScale(points[0][1]) - 15 - 15)
              .attr('width', 80)
              .attr('height', 40)
              .attr('class', 'label-container');

            foreignObj.append('xhtml:div')
              .style('color', color)
              .style('font-size', '16px')
              .style('font-weight', 'bold')
              .style('background', 'rgba(255, 255, 255, 0.9)')
              .style('padding', '2px 6px')
              .style('border-radius', '4px')
              .style('text-shadow', '0 0 3px white')
              .style('white-space', 'nowrap')
              .html(`\\(${label}\\)`);
          }
        }

        if (Math.abs(D) > 1e-10) {
          // Unique solution
          const x = D_x / D;
          const y = D_y / D;

          drawLine(a1, b1, c1, '#991b1b', 'L_1');
          drawLine(a2, b2, c2, '#1e3a8a', 'L_2');

          plotG.append('circle')
            .attr('class', 'solution-point')
            .attr('cx', xScale(x))
            .attr('cy', yScale(y))
            .attr('r', 6);

          document.getElementById('solution-info').innerHTML = `Solution: \\(\\begin{bmatrix} ${formatCoordinate(x)} \\\\ ${formatCoordinate(y)} \\end{bmatrix}\\)`;
        } else if (Math.abs(D_x) < 1e-10 && Math.abs(D_y) < 1e-10) {
          // Infinitely many solutions
          drawLine(a1, b1, c1, '#166534', 'L_1 \\text{ and } L_2');
          document.getElementById('solution-info').innerHTML = 'Infinitely many solutions (coincident lines)';
        } else {
          // No solution
          drawLine(a1, b1, c1, '#991b1b', 'L_1');
          drawLine(a2, b2, c2, '#1e3a8a', 'L_2');
          document.getElementById('solution-info').innerHTML = 'No solution (parallel lines)';
        }

        if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
          MathJax.typesetPromise(['#solution-info', '#plot-svg']).catch(err => console.warn('MathJax error:', err));
        }
      } catch (error) {
        displayError(error.message);
      }
    }

    // Event listeners
    document.getElementById('showAddition').addEventListener('click', () => {
      const vec1x = parseFloat(document.getElementById('vec1x').value);
      const vec1y = parseFloat(document.getElementById('vec1y').value);
      const vec2x = parseFloat(document.getElementById('vec2x').value);
      const vec2y = parseFloat(document.getElementById('vec2y').value);
      const c1 = parseFloat(document.getElementById('c1').value) || 1;
      const c2 = parseFloat(document.getElementById('c2').value) || 1;

      if (isNaN(vec1x) || isNaN(vec1y) || isNaN(vec2x) || isNaN(vec2y) || isNaN(c1) || isNaN(c2)) {
        displayError('Please enter valid numbers for all vector components and coefficients.');
      } else {
        drawLinearCombination({x: vec1x, y: vec1y}, {x: vec2x, y: vec2y}, c1, c2);
      }
    });

    document.getElementById('solveSystem').addEventListener('click', solveSystem);

    // Zoom controls
    document.getElementById('zoom-in').addEventListener('click', () => {
      svg.transition().duration(300).call(zoom.scaleBy, 1.3);
    });

    document.getElementById('zoom-out').addEventListener('click', () => {
      svg.transition().duration(300).call(zoom.scaleBy, 0.77);
    });

    document.getElementById('zoom-reset').addEventListener('click', () => {
      svg.transition().duration(500).call(zoom.transform, d3.zoomIdentity);
    });

    // Initialize
    function init() {
      if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
        renderMathJaxLabels();
        setTimeout(() => {
          document.getElementById('solveSystem').click();
        }, 100);
      } else {
        setTimeout(init, 100);
      }
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
